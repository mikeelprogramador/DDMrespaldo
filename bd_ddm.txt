/*create schema bd_ddm;*/
/*drop schema bd_ddm;*/
use bd_ddm;


/*Tabla de los usuarios*/
create table tb_usuarios(
id int not null,
nombre varchar(60) not null,
apellido varchar(60) not null,
email varchar(260) not null,
pasword varchar(100) not null,
fecha_registro varchar(50) not null,
cate_user int not null,
status_user varchar(10) null,
foto_usuarios varchar(250) null,
primary key (id)
);

/*Tabla para los productos */
create table tb_productos(
id_producto varchar(10) not null,
producto_nombre varchar(80) null,
descripcion_producto varchar(160) null,
caracteristicas_producto varchar(500) null,
cantidades int null,
id_ofertas int null,
img varchar(200) null,
precio varchar(200) null,
color varchar(150) not null,
primary key(id_producto)
);

/*Tabla de carrito*/
create table tb_carrito(
id_carrito int auto_increment,
id_usuario int not null,
foreign key(id_usuario) references tb_usuarios(id),
primary key(id_carrito)
);

/*Tabla de para los productos que esten en el carrito*/
create table tb_carypro(
id_carypro int auto_increment,
id_carrito int not null,
id_producto varchar(10) not null,
cantidad_de_productos int not null,
foreign key(id_carrito) references tb_carrito(id_carrito),
foreign key(id_producto) references tb_productos(id_producto),
primary key(id_carypro)
);

/* Tabla de categorias*/
create table tb_categorias(
id_categoria int auto_increment not null,
categoria varchar (150) not null,
primary key(id_categoria)
);

/*tabla de caracteristicas de productos */
create table tb_categoriasProducto(
id_p_c int auto_increment , 
id_producto varchar(10) not null,
id_categoria int not null,
foreign key(id_producto) references tb_productos(id_producto),
foreign key(id_categoria) references tb_categorias(id_categoria),
primary key(id_p_c)
);	

/* Tabla de comentarios */
create table tb_comentarios(
id_comentario int auto_increment,
comentario varchar(600) not null,
fechaComentario varchar(20) not null,
id_producto varchar(10) not null,
id_usuario int not null,
primary key(id_comentario),
foreign key(id_producto) references tb_productos(id_producto),
foreign key(id_usuario) references tb_usuarios(id)
);

/*Tbala de las valoraciones*/
create table tb_valoracion(
id_valoracion int not null,
id_producto varchar(10) not null,
id_usuario int not null,
valoracion varchar(100) not null,
foreign key(id_producto) references tb_productos(id_producto),
foreign key(id_usuario) references tb_usuarios(id),
primary key(id_valoracion)
);

/*tabla de compras*/
create table tb_compras(
id_compra int auto_increment,
id_usuario int not null,
departamento varchar(250) not null,
municipio varchar(250) not null,
telefono int not null,
barrio varchar(250) not null,
direccion varchar(250) not null,
fecha_de_compra varchar(50) not null,
cliente varchar(200) not null,
correo varchar (200) not null,
total_compra varchar(100) not null,
primary key(id_compra)
);

/*tabla fcaturas*/
create table tb_facturas(
id_factura int auto_increment,
id_compra int not null,
id_producto varchar(10) not null,
producto varchar(150) not null,
cantidades int not null,
sub_valor varchar(150) not null,
primary key(id_factura)
);

create table tb_departamentos(
id_departamento int not null,
departamento varchar(150) not null,
primary key(id_departamento)
);

create table tb_municipios(
id_municipio int not null,
id_departamento int not null,
municipio varchar(150) not null,
foreign key(id_departamento) references tb_departamentos(id_departamento), 
primary key(id_municipio)
);

show tables;

/*Select*/
select * from tb_usuarios;
select * from tb_productos;
select * from tb_categorias;
select * from tb_categoriasProducto;
select * from tb_comentarios;	
select * from tb_valoracion;
select * from tb_carypro;
select * from tb_carrito;
select * from tb_compras;
select * from tb_facturas;


/*borrar datos de las tablas*/
truncate tb_usuarios ;	
truncate tb_productos;
truncate tb_categorias;
truncate tb_categoriasProducto;
truncate tb_comentarios;


/*borrar tablas*/
#drop table tb_usuarios; 
#drop table tb_categoriasProducto; 
#drop table tb_productos;
#drop table tb_comentarios; 
#drop table tb_valoracion; 

update tb_compras 
set total_compra = '1'
where id_compra = '108' and id_usuario = '3';

select count(*),
(select producto_nombre from tb_productos as t3
where t2.id_producto = t3.id_producto)
from tb_compras as t1
inner join tb_facturas as t2 on t1.id_compra = t2.id_compra;

select DISTINCT producto_nombre,(select count(*) from tb_facturas as  t3 where  t1.id_producto = t3.id_producto ) as compras
from tb_productos as t1 
inner join tb_facturas as t2 on t1.id_producto = t2.id_producto;

select DISTINCT nombre,(select count(*) from tb_compras as  t3 where  t1.id = t3.id_usuario ) as compras
from tb_usuarios as t1 
inner join tb_compras as t2 on t1.id = t2.id_usuario;


select distinct t1.id_compra,(select count(*) from tb_facturas as t3 where t1.id_compra = t3.id_compra),(select nombre from tb_usuarios as t4 where t1.id_usuario = t4.id)
from tb_compras as t1 
inner join tb_facturas as t2 on t1.id_compra = t2.id_compra;

select month(now());